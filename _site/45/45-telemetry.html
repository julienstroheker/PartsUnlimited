<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>PartsUnlimited : User Telemetry</title>
        <meta name="description" content="DevOps Hands On Labs">

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/PartsUnlimited/css/syntax.css">
        <link rel="stylesheet" href="/PartsUnlimited/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div id="header" class="col-sm-12">
                    <img class="logo" src="/PartsUnlimited/assets/logo-ms-dark.png" alt="Microsoft">
<h4><a class="brand" href="/PartsUnlimited/">PartsUnlimited</a>
    <small>DevOps Hands On Labs</small>
</h4>

                </div>
            </div>

            <div class="row">
                
                
                    <div id="navigation" class="col-sm-3">
                        <ul class="nav nav-list">
    
        <li><a href="/PartsUnlimited/">Welcome</a></li>
    

    
        
        

        
            
                <li class="nav-header">.NET Core</li>
            

            
                <li data-order="0"><a href="/PartsUnlimited/core/QuickStart.html">Quick Start</a></li>
            
        
            

            
                <li data-order="1"><a href="/PartsUnlimited/core/CI.html">Continuous Integration</a></li>
            
        
            

            
                <li data-order="2"><a href="/PartsUnlimited/core/CD.html">Continuous Deployment</a></li>
            
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class="divider"></li> first to break up the content. -->
</ul>

                    </div>

                    <div id="content" class="col-sm-9">
                        <div class="page-header">
    <h2>User Telemetry
        
    </h2>
</div>

<h1 id="user-telemetry-with-application-insights">User Telemetry with Application Insights</h1>

<p>The marketing team has expressed interest in the behavior of users across the PartsUnlimited website for how to best market the products, especially how popular the web application is and where the users live. The development team would like to know which browsers and operating systems that most users browse to the site from to target better user experiences.</p>

<p>Using the out-of-box telemetry for Application Insights, the teams will be able to find out how people use the application and gain insights into the goals that they will need to achieve.</p>

<p>In this lab, you will learn about setting up Application Insights and inserting the snippet of code for usage tracking into a web application to gain further insight into how users are behaving towards your web application.</p>

<p><strong>Prerequisites</strong></p>

<ul>
  <li>
    <p>Visual Studio 2013 or higher</p>
  </li>
  <li>
    <p>PartsUnlimited website deployed to a Microsoft Azure Web App (see <a href="https://microsoft.github.io/PartsUnlimited/core/core-deployment.html">link</a></p>
  </li>
  <li>
    <p>Application Insights created in the same Azure Resource Group as the PartsUnlimited website</p>
  </li>
  <li>
    <p>Continuous Integration build with deployment to the Azure web app</p>
  </li>
</ul>

<p><strong>Tasks Overview</strong></p>

<ol>
  <li>
    <p>Set up Application Insights for PartsUnlimited</p>
  </li>
  <li>
    <p>View real-time results for user telemetry in the Azure portal</p>
  </li>
</ol>

<h3 id="task-1-set-up-application-insights-for-partsunlimited">Task 1: Set up Application Insights for PartsUnlimited</h3>
<p><strong>Step 1.</strong> In an Internet browser, navigate to <a href="http://portal.azure.com">http://portal.azure.com</a> and
sign in with your credentials.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step1.png" alt="" /></p>

<p><strong>Step 2.</strong> Click on the “Browse All” tile on the left column, select
“Application Insights,” and click on the name of the telemetry that was created when you deployed the resource group using the Deployment template in the PartsUnlimited solution. The name of the telemetry should match the name of the PartsUnlimited name plus “Insights.”</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step2.png" alt="" /></p>

<p><strong>Step 3.</strong> In the PartsUnlimited Application Insights telemetry, click on the “Settings” tile and then “Properties.” You will want to keep this browser window open with the details of the telemetry name, location, instrumentation key, and subscription information when we attach it to the PartsUnlimited website.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step3.png" alt="" /></p>

<p><strong>Step 4.</strong> To receive data, we will need to attach the PartsUnlimited Application Insights telemetry to the PartsUnlimited project in Visual Studio. In Visual Studio, open the PartsUnlimited solution.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step4.png" alt="" /></p>

<p><strong>Step 5.</strong> In the PartsUnlimited solution, right-click on the PartsUnlimitedWebsite project and select “Add Application Insights telemetry.”</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step5.png" alt="" /></p>

<p><strong>Step 6.</strong> In the “Add Application Insights to Project” window, click on the “Use different account” hyperlink.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step6.png" alt="" /></p>

<p><strong>Step 7.</strong> Since we have the subscription and resource information for our PartsUnlimited Application Insights telemetry, click on the button, “Use advanced mode.”</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step7.png" alt="" /></p>

<p><strong>Step 8.</strong> Fill in the subscription ID, resource group, Application Insights resource name, and Instrumentation key found in the new portal from step 3. Then press the “Add Application Insights to Project” button to add the telemetry in the project.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step8.png" alt="" /></p>

<p><strong>Step 9.</strong> Back in the Azure Portal, in the PartsUnlimited Application Insights telemetry, in the Application Health panel, click on the “Learn how to collect server response time data” overlay. Before Application Insights receives any information, we need to add script code to monitor each web page in the PartsUnlimited project.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step9.png" alt="" /></p>

<p><strong>Step 10.</strong> In the Quickstart panel to add Application Insights to your project, click on “Get code to monitor my web pages” and copy the end-user usage analytics code.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step10.png" alt="" /></p>

<p><strong>Step 11.</strong> Back in Visual Studio, in the PartsUnlimitedWebsite project, in Views/Shared/_Layout.cshtml, paste the snippet of code you copied for the end-user usage analytics code from the Azure portal before the rest of the scripts between the head tag.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step11.png" alt="" /></p>

<p><strong>Step 12.</strong> In the “Changes” tile in Team Explorer, commit the changes of adding Application Insights (adding ApplicationInsights.config, editing the publish profile, _Layout.cshtml, packages.config and web.config) and sync to the repo which should kick off an automated build and deploy to the website.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step12a.png" alt="" /></p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step12b.png" alt="" /></p>

<p>Now that the telemetry has been added to the web application, it may take a few minutes for Application Insights to refresh.</p>

<h3 id="task-2-view-real-time-results-for-user-telemetry-in-the-azure-portal">Task 2: View real-time results for user telemetry in the Azure portal</h3>

<p>Now that we’ve given Application Insights time to refresh, we can take a look at the usage data in the new Azure Portal. The Portal will show a variety of metrics out of the box, including number of sessions, users, and browser sessions.</p>

<p><strong>Step 1.</strong> In an Internet browser, navigate to <a href="http://portal.azure.com">http://portal.azure.com</a> and
sign in with your credentials.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step1.png" alt="" /></p>

<p><strong>Step 2.</strong> Click on the “Browse All” tile on the left column, select
“Application Insights,” and click on the name of the telemetry that was created when you deployed the resource group using the Deployment template in the PartsUnlimited solution. The name of the telemetry should match the name of the PartsUnlimited name plus “Insights.”</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/prereq-step2.png" alt="" /></p>

<p><strong>Step 3.</strong> In the overview panel of the Application Insights instance, overall application health will be shown in server response time, browser page load time, server requests, and failed requests. (Actual times may vary)</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step3.png" alt="" /></p>

<p><strong>Step 4.</strong> Scroll down in the overview portal and click on the “Usage” tile.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step4.png" alt="" /></p>

<p><strong>Step 5.</strong> Note the Usage timeline. By drilling into usage, we can gauge how popular our web application is based on the number of distinct users, active sessions, and number of calls to trackPageView() (usually called once). Click in the chart on “Users” to view more information about the users.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step5.png" alt="" /></p>

<p><strong>Step 6.</strong> In the Users timeline, note the number of users, new users, and page views. Additionally, the unique count of users by country is recorded. Click the X in the upper-right corner to close the Users panel.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step6.png" alt="" /></p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step6b.png" alt="" /></p>

<p><strong>Step 7.</strong> Back in the overview panel of the Application Insights instance, click on the chart for Browser Page Load Time.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step7.png" alt="" /></p>

<p><strong>Step 8.</strong> In the Browsers timeline, note the receiving response time, client processing time, page load network time, send request time, server response time, and page views. Additionally, the average count of browser page load time is shown below the timeline. Click on the timeline chart.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step8.png" alt="" /></p>

<p><strong>Step 9.</strong> In the Chart Details pane, scroll down to the Client area and uncheck all of the properties except for Receiving Response Time. Then, turn on the Grouping and select “Browser” as the “group by” property. The Browsers timeline will change and show the average receiving response time broken down into the various browsers that were used to log into the site.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step9.png" alt="" /></p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step9b.png" alt="" /></p>

<p><strong>Step 10.</strong> Back in the Overview panel, scroll down and click on the “Page views” tile.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step10.png" alt="" /></p>

<p><strong>Step 11.</strong> The Page views panel will break down the total page views, number of users, and pages per session for the web application.</p>

<p><img src="/PartsUnlimited/assets/45-telemetry/task2step11.png" alt="" /></p>

<p>All of the out-of-box data from Application Insights provide different types of data to learn how users interact with your web application.</p>

<p>In this lab, you learned about setting up Application Insights and inserting the snippet of code for usage tracking into a web application to gain further insight into how users are behaving towards your web application.</p>

<p>Try these labs out for next steps:</p>

<ul>
  <li>
    <p><a href="http://microsoft.github.io/PartsUnlimited/45/45-testing-production.html">Testing in Production hands-on lab</a></p>
  </li>
  <li>
    <p><a href="http://microsoft.github.io/PartsUnlimited/45/45-apm.html">Application Performance Monitoring hands-on lab</a></p>
  </li>
</ul>

<p><strong>Further Resources</strong></p>

<p><a href="https://azure.microsoft.com/en-us/documentation/articles/app-insights-web-track-usage/">Usage analysis for web applications with Application Insights</a></p>


                    </div>
                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="https://github.com/Microsoft/PartsUnlimited">PartsUnlimited</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
    </body>
</html>
